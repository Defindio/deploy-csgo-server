A docker image for running a dedicated server for the game [CS:GO](https://blog.counter-strike.net/). Configured to use the [Get5](https://github.com/splewis/get5/) plugin alongside [Metamod:Source](https://www.sourcemm.net/) and [Sourcemod](https://www.sourcemod.net/) to host a quick setup scrim server. This is a modified version of [CM2Walki's](https://github.com/CM2Walki/CSGO) Dockerfile.

# How to use this image

## Deploying on clean AWS instance

Copy <b>cs_aws.sh</b> to your instance and run it:

```
chmod +x cs_aws.sh && ./cs_aws.sh
```
## Simple usage (recommended)

Clone this repository locally:<br/>
```console
$ git clone https://github.com/FragSoc/csgo-server-scrim.git
```

Create a new directory for the game installation:
```console
$ mkdir -p $(pwd)/csgo-data
$ chmod 777 $(pwd)/csgo-data # Makes sure the directory is writeable by the unprivileged container user
```

**Make necessary edits to both the docker-compose.yml and custom_server_template.cfg.**
**Look at configuration section below for guidance.**

Run docker-compose up:<br/>
```console
$ docker-compose up
```

Due to the config files needing to be generated by the plugin, you'll have to stop the container and start it again for the setup to complete:<br/>
```console
$ docker-compose up
```

**The container will automatically update the game on startup, so if there is a game update just restart the container.**

# Configuration
##Custom server settings
Before you run the initial startup, you will need to edit the custom_server_template.cfg file within the same dirtectory. This will be used to overwrite the /cfg/server.cfg file each time the server starts.
Should you wish to make any edits once the server has been created, you can do so using the below command and the server will use them once restarted:
```console
$ docker exec -it *CONTAINER_NAME* nano /home/steam/custom_server_template.cfg
```

## Environment Variables
You can overwrite these values within the docker-compose file, below are the defaults: 
```dockerfile
SRCDS_PORT=27015 
SRCDS_TV_PORT=27020 
SRCDS_CLIENT_PORT=27005 
SRCDS_TOKEN=0 
METAMOD_VERSION=1.10 
SOURCEMOD_VERSION=1.10
```
**If you edit the ports you will need to adjust these within the docker-compose file also.**

---
### TODO: 

1. Create a way to generate SRCDS tokens for each server.
2. Find a way to deploy on demand.
3. Restructure <b>cs_aws.sh</b> to allow for multiple CSGO server instances to be deployed at once.